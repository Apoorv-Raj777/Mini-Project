<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Heatmap & Safety — Sarthi</title>

  <!-- Core styles (use same stack as Help Others) -->
  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/components.css">
  <link rel="stylesheet" href="/css/pages.css">

  <!-- Page-specific -->
  <link rel="stylesheet" href="/css/heatmap.css">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
</head>
<body>
  <div id="header"></div>

  <main>
    <div class="page-grid page-wrap" role="main" aria-label="Heatmap page">
      <!-- Left controls (30%) -->
      <section class="card left-panel" aria-labelledby="heatTitle">
        <h1 id="heatTitle">Heatmap & Safety</h1>
        <p class="hint">Visualize aggregated safety data. Click map points for safety score and samples. Submit audits via Help Others to improve coverage.</p>

        <div class="field">
          <label for="bandSelect">Time Band</label>
          <select id="bandSelect" class="field-select">
            <option value="overall">Overall</option>
            <option value="morning">Morning</option>
            <option value="afternoon">Afternoon</option>
            <option value="evening">Evening</option>
            <option value="night" selected>Night</option>
            <option value="midnight" selected>MidNight</option>
          </select>
        </div>

        <div class="field">
          <label for="samplesRange">Min Samples <span id="samplesValue" style="margin-left:auto;font-weight:700;color:var(--primary)">1</span></label>
          <input id="samplesRange" type="range" min="1" max="20" value="1">
        </div>

        <div class="field">
          <label for="showMarkers">Details</label>
          <div style="display:flex;gap:8px;align-items:center">
            <button id="toggleMarkers" class="btn-outline">Toggle Points</button>
            <button id="resetView" class="btn-ghost">Reset View</button>
          </div>
        </div>

        <div class="hint">Tip: drag/zoom the map to load area-specific heat data.</div>

        <div id="formFeedback" class="hint" role="status" aria-live="polite"></div>

        <div class="controls" style="margin-top:12px">
          <button id="applyBtn" class="btn-primary">Apply</button>
          <button id="downloadBtn" class="btn-outline">Export CSV</button>
        </div>
      </section>

      <!-- Right map (70%) -->
      <aside class="card map-panel" aria-label="Heatmap map panel">
        <div id="map" aria-label="Heatmap map">Loading map…</div>

        <!-- Safety score overlay (hidden until click) -->
        <div class="map-score" id="mapScore" aria-hidden="true" style="display:none;">
          <div class="score-label small">Safety Score</div>
          <div class="score-value" id="scoreValue">—</div>
          <div class="samples small" id="scoreSamples">samples: —</div>
        </div>

        <div class="map-legend" aria-hidden="true">
          <span class="dot low" style="margin-right:8px"></span><span class="small">Safe</span>
          <span style="margin-left:12px;margin-right:8px" class="dot med"></span><span class="small">Moderate</span>
          <span style="margin-left:12px" class="dot high"></span><span class="small">Unsafe</span>
        </div>
      </aside>
    </div>
  </main>

  <div id="footer"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

  <!-- Modules (heatmap.js should implement initHeatmapPage and event handlers) -->
  <script type="module" src="/js/heatmap.js"></script>
  <!-- App-level scripts (inject header/footer, auth helpers, toasts) -->
  <script type="module" src="/js/app.js"></script>
  <script type="module" src="/js/ui_helpers.js"></script>
</body>
</html>
